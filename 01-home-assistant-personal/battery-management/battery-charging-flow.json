[
    {
        "id": "battery_tab",
        "type": "tab",
        "label": "æ™ºèƒ½å……é›»é›»æ± ç®¡ç†ç³»çµ±",
        "disabled": false,
        "info": "æ™ºèƒ½å……é›»é›»æ± ç®¡ç†ç³»çµ±\n\nåŠŸèƒ½ï¼š\n1. æ‰‹å‹•å……é›»è‡ªå‹•è¨ˆæ™‚é—œé–‰\n2. å®šæœŸç¶­è­·å……é›»\n3. å¤šé‡é€šçŸ¥ç³»çµ±\n4. å®‰å…¨ä¿è­·æ©Ÿåˆ¶\n\næ”¯æ´é›»æ± ï¼š\n- ç‰§ç”°BL1041B (HS300 2-4æ’åº§)\n- ENELOOP 3è™Ÿ (HS300 2-5æ’åº§)\n- ENELOOP 4è™Ÿ (HS300 2-6æ’åº§)",
        "env": []
    },
    {
        "id": "makita_monitor",
        "type": "server-state-changed",
        "z": "battery_tab",
        "name": "ç‰§ç”°é›»æ± æ’åº§ç›£æ§",
        "server": "home_assistant_server",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["media_player.volume_set"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 150,
        "y": 100,
        "wires": [["makita_logic"]]
    },
    {
        "id": "eneloop_aa_monitor",
        "type": "server-state-changed",
        "z": "battery_tab",
        "name": "ENELOOP 3è™Ÿæ’åº§ç›£æ§",
        "server": "home_assistant_server",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["switch.tp_link_power_strip_eb2f_cha_shang_5"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 150,
        "y": 200,
        "wires": [["eneloop_aa_logic"]]
    },
    {
        "id": "eneloop_aaa_monitor",
        "type": "server-state-changed",
        "z": "battery_tab",
        "name": "ENELOOP 4è™Ÿæ’åº§ç›£æ§",
        "server": "home_assistant_server",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["switch.tp_link_power_strip_eb2f_cha_shang_6"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 150,
        "y": 300,
        "wires": [["eneloop_aaa_logic"]]
    },
    {
        "id": "makita_logic",
        "type": "function",
        "z": "battery_tab",
        "name": "ç‰§ç”°å……é›»é‚è¼¯",
        "func": "// è¼‰å…¥é…ç½®\nconst config = global.get('batteryChargingConfig') || {};\nconst batteryConfig = config.batteryConfig?.makita || {\n    chargingTime: 90,\n    maxChargingTime: 180,\n    friendlyName: 'ç‰§ç”°BL1041Bå……é›»é›»æ± ',\n    location: 'HS300 2-4æ’åº§'\n};\n\nconst newState = msg.payload;\nconst oldState = msg.data.old_state?.state;\nconst entityId = msg.data.entity_id;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹å‹•é–‹å•Ÿ (å¾offè®Šç‚ºon)\nif (oldState === 'off' && newState === 'on') {\n    // æª¢æŸ¥æ˜¯å¦å·²æœ‰è¨ˆæ™‚å™¨åœ¨é‹è¡Œ\n    const timerId = flow.get('makita_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('makita_timer_id', null);\n    }\n    \n    // è¨˜éŒ„å……é›»é–‹å§‹æ™‚é–“\n    const startTime = new Date();\n    flow.set('makita_charge_start', startTime.getTime());\n    \n    // è¨­å®šå……é›»è¨ˆæ™‚å™¨\n    const chargingTimeMs = batteryConfig.chargingTime * 60 * 1000;\n    const newTimerId = setTimeout(() => {\n        // æ™‚é–“åˆ°ï¼Œè‡ªå‹•é—œé–‰æ’åº§\n        const stopMsg = {\n            payload: {\n                domain: 'media_player',\n                service: 'turn_off',\n                data: {},\n                target: {\n                    entity_id: entityId\n                }\n            },\n            batteryType: 'makita',\n            action: 'auto_stop',\n            chargingTime: batteryConfig.chargingTime\n        };\n        node.send([null, stopMsg, null]);\n        flow.set('makita_timer_id', null);\n    }, chargingTimeMs);\n    \n    flow.set('makita_timer_id', newTimerId);\n    \n    // ç™¼é€å……é›»é–‹å§‹é€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'ğŸ”‹ å……é›»é–‹å§‹',\n            message: `ğŸ”‹ ${batteryConfig.friendlyName} é–‹å§‹å……é›»\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ é è¨ˆå……é›»æ™‚é–“ï¼š${batteryConfig.chargingTime}åˆ†é˜\\nğŸ• é–‹å§‹æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'makita',\n        action: 'charging_started'\n    };\n    \n    // æ›´æ–°Home Assistantè¨˜éŒ„\n    const updateMsg = {\n        payload: {\n            domain: 'input_datetime',\n            service: 'set_datetime',\n            data: {\n                datetime: new Date().toISOString().slice(0, 19)\n            },\n            target: {\n                entity_id: 'input_datetime.makita_last_charge'\n            }\n        }\n    };\n    \n    return [notifyMsg, null, updateMsg];\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºé—œé–‰ç‹€æ…‹\nif (newState === 'off' && oldState === 'on') {\n    // æ¸…é™¤è¨ˆæ™‚å™¨\n    const timerId = flow.get('makita_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('makita_timer_id', null);\n    }\n    \n    // è¨ˆç®—å¯¦éš›å……é›»æ™‚é–“\n    const startTime = flow.get('makita_charge_start');\n    const actualTime = startTime ? Math.round((new Date().getTime() - startTime) / 60000) : 0;\n    \n    // ç™¼é€å……é›»å®Œæˆé€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'âœ… å……é›»å®Œæˆ',\n            message: `âœ… ${batteryConfig.friendlyName} å……é›»å®Œæˆ\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ å……é›»æ™‚é•·ï¼š${actualTime}åˆ†é˜\\nğŸ• å®Œæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'makita',\n        action: 'charging_completed',\n        actualTime: actualTime\n    };\n    \n    return [notifyMsg, null, null];\n}\n\nreturn null;",
        "outputs": 3,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 100,
        "wires": [["notification_sender"], ["device_controller"], ["ha_updater"]]
    },
    {
        "id": "eneloop_aa_logic",
        "type": "function",
        "z": "battery_tab",
        "name": "ENELOOP 3è™Ÿå……é›»é‚è¼¯",
        "func": "// è¼‰å…¥é…ç½®\nconst config = global.get('batteryChargingConfig') || {};\nconst batteryConfig = config.batteryConfig?.eneloop_aa || {\n    chargingTime: 240,\n    maxChargingTime: 360,\n    friendlyName: 'ENELOOP 3è™Ÿå……é›»é›»æ± ',\n    location: 'HS300 2-5æ’åº§'\n};\n\nconst newState = msg.payload;\nconst oldState = msg.data.old_state?.state;\nconst entityId = msg.data.entity_id;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹å‹•é–‹å•Ÿ (å¾offè®Šç‚ºon)\nif (oldState === 'off' && newState === 'on') {\n    // æª¢æŸ¥æ˜¯å¦å·²æœ‰è¨ˆæ™‚å™¨åœ¨é‹è¡Œ\n    const timerId = flow.get('eneloop_aa_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('eneloop_aa_timer_id', null);\n    }\n    \n    // è¨˜éŒ„å……é›»é–‹å§‹æ™‚é–“\n    const startTime = new Date();\n    flow.set('eneloop_aa_charge_start', startTime.getTime());\n    \n    // è¨­å®šå……é›»è¨ˆæ™‚å™¨\n    const chargingTimeMs = batteryConfig.chargingTime * 60 * 1000;\n    const newTimerId = setTimeout(() => {\n        // æ™‚é–“åˆ°ï¼Œè‡ªå‹•é—œé–‰æ’åº§\n        const stopMsg = {\n            payload: {\n                domain: 'switch',\n                service: 'turn_off',\n                data: {},\n                target: {\n                    entity_id: entityId\n                }\n            },\n            batteryType: 'eneloop_aa',\n            action: 'auto_stop',\n            chargingTime: batteryConfig.chargingTime\n        };\n        node.send([null, stopMsg, null]);\n        flow.set('eneloop_aa_timer_id', null);\n    }, chargingTimeMs);\n    \n    flow.set('eneloop_aa_timer_id', newTimerId);\n    \n    // ç™¼é€å……é›»é–‹å§‹é€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'ğŸ”‹ å……é›»é–‹å§‹',\n            message: `ğŸ”‹ ${batteryConfig.friendlyName} é–‹å§‹å……é›»\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ é è¨ˆå……é›»æ™‚é–“ï¼š${batteryConfig.chargingTime}åˆ†é˜\\nğŸ• é–‹å§‹æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'eneloop_aa',\n        action: 'charging_started'\n    };\n    \n    // æ›´æ–°Home Assistantè¨˜éŒ„\n    const updateMsg = {\n        payload: {\n            domain: 'input_datetime',\n            service: 'set_datetime',\n            data: {\n                datetime: new Date().toISOString().slice(0, 19)\n            },\n            target: {\n                entity_id: 'input_datetime.eneloop_aa_last_charge'\n            }\n        }\n    };\n    \n    return [notifyMsg, null, updateMsg];\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºé—œé–‰ç‹€æ…‹\nif (newState === 'off' && oldState === 'on') {\n    // æ¸…é™¤è¨ˆæ™‚å™¨\n    const timerId = flow.get('eneloop_aa_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('eneloop_aa_timer_id', null);\n    }\n    \n    // è¨ˆç®—å¯¦éš›å……é›»æ™‚é–“\n    const startTime = flow.get('eneloop_aa_charge_start');\n    const actualTime = startTime ? Math.round((new Date().getTime() - startTime) / 60000) : 0;\n    \n    // ç™¼é€å……é›»å®Œæˆé€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'âœ… å……é›»å®Œæˆ',\n            message: `âœ… ${batteryConfig.friendlyName} å……é›»å®Œæˆ\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ å……é›»æ™‚é•·ï¼š${actualTime}åˆ†é˜\\nğŸ• å®Œæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'eneloop_aa',\n        action: 'charging_completed',\n        actualTime: actualTime\n    };\n    \n    return [notifyMsg, null, null];\n}\n\nreturn null;",
        "outputs": 3,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 200,
        "wires": [["notification_sender"], ["device_controller"], ["ha_updater"]]
    },
    {
        "id": "eneloop_aaa_logic",
        "type": "function",
        "z": "battery_tab",
        "name": "ENELOOP 4è™Ÿå……é›»é‚è¼¯",
        "func": "// è¼‰å…¥é…ç½®\nconst config = global.get('batteryChargingConfig') || {};\nconst batteryConfig = config.batteryConfig?.eneloop_aaa || {\n    chargingTime: 210,\n    maxChargingTime: 300,\n    friendlyName: 'ENELOOP 4è™Ÿå……é›»é›»æ± ',\n    location: 'HS300 2-6æ’åº§'\n};\n\nconst newState = msg.payload;\nconst oldState = msg.data.old_state?.state;\nconst entityId = msg.data.entity_id;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹å‹•é–‹å•Ÿ (å¾offè®Šç‚ºon)\nif (oldState === 'off' && newState === 'on') {\n    // æª¢æŸ¥æ˜¯å¦å·²æœ‰è¨ˆæ™‚å™¨åœ¨é‹è¡Œ\n    const timerId = flow.get('eneloop_aaa_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('eneloop_aaa_timer_id', null);\n    }\n    \n    // è¨˜éŒ„å……é›»é–‹å§‹æ™‚é–“\n    const startTime = new Date();\n    flow.set('eneloop_aaa_charge_start', startTime.getTime());\n    \n    // è¨­å®šå……é›»è¨ˆæ™‚å™¨\n    const chargingTimeMs = batteryConfig.chargingTime * 60 * 1000;\n    const newTimerId = setTimeout(() => {\n        // æ™‚é–“åˆ°ï¼Œè‡ªå‹•é—œé–‰æ’åº§\n        const stopMsg = {\n            payload: {\n                domain: 'switch',\n                service: 'turn_off',\n                data: {},\n                target: {\n                    entity_id: entityId\n                }\n            },\n            batteryType: 'eneloop_aaa',\n            action: 'auto_stop',\n            chargingTime: batteryConfig.chargingTime\n        };\n        node.send([null, stopMsg, null]);\n        flow.set('eneloop_aaa_timer_id', null);\n    }, chargingTimeMs);\n    \n    flow.set('eneloop_aaa_timer_id', newTimerId);\n    \n    // ç™¼é€å……é›»é–‹å§‹é€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'ğŸ”‹ å……é›»é–‹å§‹',\n            message: `ğŸ”‹ ${batteryConfig.friendlyName} é–‹å§‹å……é›»\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ é è¨ˆå……é›»æ™‚é–“ï¼š${batteryConfig.chargingTime}åˆ†é˜\\nğŸ• é–‹å§‹æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'eneloop_aaa',\n        action: 'charging_started'\n    };\n    \n    // æ›´æ–°Home Assistantè¨˜éŒ„\n    const updateMsg = {\n        payload: {\n            domain: 'input_datetime',\n            service: 'set_datetime',\n            data: {\n                datetime: new Date().toISOString().slice(0, 19)\n            },\n            target: {\n                entity_id: 'input_datetime.eneloop_aaa_last_charge'\n            }\n        }\n    };\n    \n    return [notifyMsg, null, updateMsg];\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºé—œé–‰ç‹€æ…‹\nif (newState === 'off' && oldState === 'on') {\n    // æ¸…é™¤è¨ˆæ™‚å™¨\n    const timerId = flow.get('eneloop_aaa_timer_id');\n    if (timerId) {\n        clearTimeout(timerId);\n        flow.set('eneloop_aaa_timer_id', null);\n    }\n    \n    // è¨ˆç®—å¯¦éš›å……é›»æ™‚é–“\n    const startTime = flow.get('eneloop_aaa_charge_start');\n    const actualTime = startTime ? Math.round((new Date().getTime() - startTime) / 60000) : 0;\n    \n    // ç™¼é€å……é›»å®Œæˆé€šçŸ¥\n    const notifyMsg = {\n        payload: {\n            title: 'âœ… å……é›»å®Œæˆ',\n            message: `âœ… ${batteryConfig.friendlyName} å……é›»å®Œæˆ\\nğŸ“ ä½ç½®ï¼š${batteryConfig.location}\\nâ±ï¸ å……é›»æ™‚é•·ï¼š${actualTime}åˆ†é˜\\nğŸ• å®Œæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`\n        },\n        batteryType: 'eneloop_aaa',\n        action: 'charging_completed',\n        actualTime: actualTime\n    };\n    \n    return [notifyMsg, null, null];\n}\n\nreturn null;",
        "outputs": 3,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 300,
        "wires": [["notification_sender"], ["device_controller"], ["ha_updater"]]
    },
    {
        "id": "maintenance_check",
        "type": "inject",
        "z": "battery_tab",
        "name": "æ¯æ—¥ç¶­è­·æª¢æŸ¥",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "maintenance_check",
        "payloadType": "str",
        "x": 150,
        "y": 450,
        "wires": [["maintenance_logic"]]
    },
    {
        "id": "maintenance_logic",
        "type": "function",
        "z": "battery_tab",
        "name": "ç¶­è­·å……é›»é‚è¼¯",
        "func": "// è¼‰å…¥é…ç½®\nconst config = global.get('batteryChargingConfig') || {};\nconst batteries = config.batteryConfig || {};\n\n// æª¢æŸ¥ç³»çµ±æ˜¯å¦å•Ÿç”¨\nconst systemEnabled = global.get('battery_management_enabled') !== false;\nconst autoMaintenance = global.get('battery_auto_maintenance') !== false;\n\nif (!systemEnabled || !autoMaintenance) {\n    return null;\n}\n\n// ç²å–ç•¶å‰æ™‚é–“\nconst now = new Date();\nconst messages = [];\n\n// æª¢æŸ¥æ¯å€‹é›»æ± çš„ç¶­è­·éœ€æ±‚\nObject.keys(batteries).forEach(batteryKey => {\n    const battery = batteries[batteryKey];\n    const lastChargeKey = `${batteryKey}_last_charge`;\n    const lastChargeTime = flow.get(lastChargeKey);\n    \n    if (lastChargeTime) {\n        const daysSinceCharge = Math.floor((now.getTime() - lastChargeTime) / (1000 * 60 * 60 * 24));\n        \n        // æª¢æŸ¥æ˜¯å¦éœ€è¦ç¶­è­·å……é›»\n        if (daysSinceCharge >= battery.maintenanceCycle) {\n            // å‰µå»ºç¶­è­·å……é›»è¨Šæ¯\n            const maintenanceMsg = {\n                payload: {\n                    domain: battery.entityId.includes('switch') ? 'switch' : 'media_player',\n                    service: 'turn_on',\n                    data: {},\n                    target: {\n                        entity_id: battery.entityId\n                    }\n                },\n                batteryType: batteryKey,\n                action: 'maintenance_charging',\n                daysSinceLastCharge: daysSinceCharge\n            };\n            \n            // å‰µå»ºé€šçŸ¥è¨Šæ¯\n            const notifyMsg = {\n                payload: {\n                    title: 'ğŸ”„ ç¶­è­·å……é›»',\n                    message: `ğŸ”„ ${battery.friendlyName} é–‹å§‹ç¶­è­·å……é›»\\nğŸ“ ä½ç½®ï¼š${battery.location}\\nğŸ“… è·é›¢ä¸Šæ¬¡å……é›»ï¼š${daysSinceCharge}å¤©\\nâ±ï¸ é è¨ˆå……é›»æ™‚é–“ï¼š${battery.chargingTime}åˆ†é˜`\n                },\n                batteryType: batteryKey,\n                action: 'maintenance_started'\n            };\n            \n            messages.push([notifyMsg, maintenanceMsg]);\n        }\n    }\n});\n\n// å¦‚æœæœ‰éœ€è¦ç¶­è­·çš„é›»æ± ï¼Œç™¼é€è¨Šæ¯\nif (messages.length > 0) {\n    return messages;\n}\n\nreturn null;",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 450,
        "wires": [["notification_sender"], ["device_controller"]]
    },
    {
        "id": "notification_sender",
        "type": "function",
        "z": "battery_tab",
        "name": "é€šçŸ¥ç™¼é€å™¨",
        "func": "// è¼‰å…¥é…ç½®\nconst config = global.get('batteryChargingConfig') || {};\nconst notificationConfig = config.notificationConfig || {};\nconst utils = config.utils || {};\n\n// æª¢æŸ¥æ˜¯å¦åœ¨éœéŸ³æ™‚é–“\nif (utils.isQuietHours && utils.isQuietHours()) {\n    // åœ¨éœéŸ³æ™‚é–“ï¼Œåªç™¼é€ç·Šæ€¥é€šçŸ¥\n    if (msg.action !== 'charging_error' && msg.action !== 'safety_stop') {\n        return null;\n    }\n}\n\n// æº–å‚™é€šçŸ¥è¨Šæ¯\nconst title = msg.payload.title || 'é›»æ± ç®¡ç†é€šçŸ¥';\nconst message = msg.payload.message || 'é›»æ± ç‹€æ…‹è®Šæ›´';\n\n// å‰µå»ºå¤šå€‹è¼¸å‡ºè¨Šæ¯\nconst messages = [];\n\n// NotifyHelper é€šçŸ¥\nif (notificationConfig.notifyHelper?.enabled) {\n    messages.push({\n        payload: {\n            domain: 'notify',\n            service: notificationConfig.notifyHelper.service || 'notify',\n            data: {\n                title: title,\n                message: message,\n                data: {\n                    priority: notificationConfig.notifyHelper.priority || 'normal'\n                }\n            }\n        }\n    });\n}\n\n// Synology Chat é€šçŸ¥\nif (notificationConfig.synologyChat?.enabled) {\n    messages.push({\n        payload: {\n            domain: 'notify',\n            service: notificationConfig.synologyChat.service || 'synology_chat_bot_3',\n            data: {\n                title: title,\n                message: message\n            }\n        }\n    });\n}\n\n// Telegram é€šçŸ¥\nif (notificationConfig.telegram?.enabled) {\n    messages.push({\n        payload: {\n            domain: 'notify',\n            service: notificationConfig.telegram.service || 'telegram',\n            data: {\n                title: title,\n                message: message,\n                data: {\n                    parse_mode: 'HTML'\n                }\n            }\n        }\n    });\n}\n\nreturn messages;",
        "outputs": 3,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 250,
        "wires": [["notify_helper"], ["synology_chat"], ["telegram_notify"]]
    },
    {
        "id": "device_controller",
        "type": "api-call-service",
        "z": "battery_tab",
        "name": "è¨­å‚™æ§åˆ¶å™¨",
        "server": "home_assistant_server",
        "version": 6,
        "debugenabled": false,
        "domain": "{{payload.domain}}",
        "service": "{{payload.service}}",
        "areaId": [],
        "deviceId": [],
        "entityId": "{{payload.target.entity_id}}",
        "data": "{{payload.data}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 650,
        "y": 350,
        "wires": [[]]
    },
    {
        "id": "ha_updater",
        "type": "api-call-service",
        "z": "battery_tab",
        "name": "HAè¨˜éŒ„æ›´æ–°",
        "server": "home_assistant_server",
        "version": 6,
        "debugenabled": false,
        "domain": "{{payload.domain}}",
        "service": "{{payload.service}}",
        "areaId": [],
        "deviceId": [],
        "entityId": "{{payload.target.entity_id}}",
        "data": "{{payload.data}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 650,
        "y": 150,
        "wires": [[]]
    },
    {
        "id": "notify_helper",
        "type": "api-call-service",
        "z": "battery_tab",
        "name": "NotifyHelper",
        "server": "home_assistant_server",
        "version": 6,
        "debugenabled": false,
        "domain": "{{payload.domain}}",
        "service": "{{payload.service}}",
        "areaId": [],
        "deviceId": [],
        "entityId": "",
        "data": "{{payload.data}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 850,
        "y": 200,
        "wires": [[]]
    },
    {
        "id": "synology_chat",
        "type": "api-call-service",
        "z": "battery_tab",
        "name": "Synology Chat",
        "server": "home_assistant_server",
        "version": 6,
        "debugenabled": false,
        "domain": "{{payload.domain}}",
        "service": "{{payload.service}}",
        "areaId": [],
        "deviceId": [],
        "entityId": "",
        "data": "{{payload.data}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 850,
        "y": 250,
        "wires": [[]]
    },
    {
        "id": "telegram_notify",
        "type": "api-call-service",
        "z": "battery_tab",
        "name": "Telegram",
        "server": "home_assistant_server",
        "version": 6,
        "debugenabled": false,
        "domain": "{{payload.domain}}",
        "service": "{{payload.service}}",
        "areaId": [],
        "deviceId": [],
        "entityId": "",
        "data": "{{payload.data}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 850,
        "y": 300,
        "wires": [[]]
    },
    {
        "id": "home_assistant_server",
        "type": "server",
        "name": "Home Assistant",
        "version": 4,
        "addon": true,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true,
        "heartbeat": false,
        "heartbeatInterval": 30
    }
]
