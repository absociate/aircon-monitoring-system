[
    {
        "id": "f1e2d3c4b5a6",
        "type": "tab",
        "label": "ç©ºèª¿è¨­å‚™é€šçŸ¥ç³»çµ±",
        "disabled": false,
        "info": "ç›£æ§5å€‹ç©ºèª¿è¨­å‚™çš„é–‹å•Ÿèˆ‡é—œé–‰ç‹€æ…‹ï¼Œä¸¦ç™¼é€é€šçŸ¥åˆ° NotifyHelperã€Synology Chat å’Œ Telegram\n\nè¨­å‚™æ¸…å–®ï¼š\n1. åŠ æ¿•å™¨ (humidifier.rdi_640hhchu_shi_ji)\n2. å…¨ç†±äº¤æ›å™¨ (fan.kpi_253hwquan_re_jiao_huan_qi_air_speed)\n3. å®¢å»³å†·æ°£ (climate.ke_ting_leng_qi)\n4. ä¸»è‡¥å†·æ°£ (climate.zhu_wo_leng_qi)\n5. æ¬¡è‡¥å†·æ°£ (climate.ci_wo_leng_qi)"
    },
    {
        "id": "humidifier_monitor",
        "type": "server-state-changed",
        "z": "aircon_flow_tab",
        "name": "åŠ æ¿•å™¨ç‹€æ…‹ç›£æ§",
        "server": "home_assistant_server",
        "version": 4,
        "exposeToHomeAssistant": false,
        "haConfig": [],
        "entityidfilter": "humidifier.rdi_640hhchu_shi_ji",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 150,
        "y": 100,
        "wires": [["state_processor"]]
    },
    {
        "id": "fan_monitor",
        "type": "server-state-changed",
        "z": "aircon_flow_tab",
        "name": "å…¨ç†±äº¤æ›å™¨ç›£æ§",
        "server": "home_assistant_server",
        "version": 4,
        "exposeToHomeAssistant": false,
        "haConfig": [],
        "entityidfilter": "fan.kpi_253hwquan_re_jiao_huan_qi_air_speed",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 150,
        "y": 160,
        "wires": [["state_processor"]]
    },
    {
        "id": "living_room_ac_monitor",
        "type": "server-state-changed",
        "z": "aircon_flow_tab",
        "name": "å®¢å»³å†·æ°£ç›£æ§",
        "server": "home_assistant_server",
        "version": 4,
        "exposeToHomeAssistant": false,
        "haConfig": [],
        "entityidfilter": "climate.ke_ting_leng_qi",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 150,
        "y": 220,
        "wires": [["state_processor"]]
    },
    {
        "id": "master_bedroom_ac_monitor",
        "type": "server-state-changed",
        "z": "aircon_flow_tab",
        "name": "ä¸»è‡¥å†·æ°£ç›£æ§",
        "server": "home_assistant_server",
        "version": 4,
        "exposeToHomeAssistant": false,
        "haConfig": [],
        "entityidfilter": "climate.zhu_wo_leng_qi",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 150,
        "y": 280,
        "wires": [["state_processor"]]
    },
    {
        "id": "second_bedroom_ac_monitor",
        "type": "server-state-changed",
        "z": "aircon_flow_tab",
        "name": "æ¬¡è‡¥å†·æ°£ç›£æ§",
        "server": "home_assistant_server",
        "version": 4,
        "exposeToHomeAssistant": false,
        "haConfig": [],
        "entityidfilter": "climate.ci_wo_leng_qi",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 150,
        "y": 340,
        "wires": [["state_processor"]]
    },
    {
        "id": "state_processor",
        "type": "function",
        "z": "aircon_flow_tab",
        "name": "ç‹€æ…‹è™•ç†å™¨",
        "func": "// è¨­å‚™åç¨±å°æ‡‰è¡¨\nconst deviceNames = {\n    'humidifier.rdi_640hhchu_shi_ji': 'åŠ æ¿•å™¨',\n    'fan.kpi_253hwquan_re_jiao_huan_qi_air_speed': 'å…¨ç†±äº¤æ›å™¨',\n    'climate.ke_ting_leng_qi': 'å®¢å»³å†·æ°£',\n    'climate.zhu_wo_leng_qi': 'ä¸»è‡¥å†·æ°£',\n    'climate.ci_wo_leng_qi': 'æ¬¡è‡¥å†·æ°£'\n};\n\n// ç‹€æ…‹å°æ‡‰è¡¨\nconst stateNames = {\n    'on': 'é–‹å•Ÿ',\n    'off': 'é—œé–‰',\n    'heat': 'åŠ ç†±',\n    'cool': 'å†·å»',\n    'auto': 'è‡ªå‹•',\n    'dry': 'é™¤æ¿•',\n    'fan_only': 'é€é¢¨',\n    'unavailable': 'ç„¡æ³•é€£æ¥',\n    'unknown': 'æœªçŸ¥ç‹€æ…‹'\n};\n\n// ç²å–å¯¦é«”ID\nconst entityId = msg.data.entity_id;\nconst newState = msg.data.new_state.state;\nconst oldState = msg.data.old_state ? msg.data.old_state.state : null;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„ç‹€æ…‹è®ŠåŒ–\nif (!newState || newState === oldState) {\n    return null;\n}\n\n// ç²å–è¨­å‚™å‹å¥½åç¨±\nconst deviceName = deviceNames[entityId] || entityId;\nconst stateName = stateNames[newState] || newState;\nconst oldStateName = stateNames[oldState] || oldState;\n\n// æª¢æŸ¥æ˜¯å¦éœ€è¦ç™¼é€é€šçŸ¥ï¼ˆé¿å…é‡è¤‡é€šçŸ¥ï¼‰\nconst contextKey = `lastState_${entityId}`;\nconst lastNotifiedState = context.get(contextKey);\n\nif (lastNotifiedState === newState) {\n    return null;\n}\n\n// æ›´æ–°ä¸Šæ¬¡é€šçŸ¥çš„ç‹€æ…‹\ncontext.set(contextKey, newState);\n\n// æº–å‚™é€šçŸ¥è¨Šæ¯\nconst timestamp = new Date().toLocaleString('zh-TW', {\n    timeZone: 'Asia/Taipei',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit'\n});\n\n// åˆ¤æ–·ç‹€æ…‹è®ŠåŒ–é¡å‹\nlet statusIcon = '';\nlet statusColor = '';\n\nif (newState === 'on' || newState === 'heat' || newState === 'cool' || newState === 'auto') {\n    statusIcon = 'ğŸŸ¢';\n    statusColor = '#28a745';\n} else if (newState === 'off') {\n    statusIcon = 'ğŸ”´';\n    statusColor = '#dc3545';\n} else {\n    statusIcon = 'ğŸŸ¡';\n    statusColor = '#ffc107';\n}\n\n// æ§‹å»ºè¨Šæ¯å…§å®¹\nconst message = {\n    deviceName: deviceName,\n    entityId: entityId,\n    newState: stateName,\n    oldState: oldStateName,\n    timestamp: timestamp,\n    statusIcon: statusIcon,\n    statusColor: statusColor,\n    title: `${deviceName}ç‹€æ…‹è®Šæ›´`,\n    shortMessage: `${deviceName} ${stateName}`,\n    fullMessage: `${statusIcon} ${deviceName}å·²${stateName}\\næ™‚é–“ï¼š${timestamp}\\nè¨­å‚™ï¼š${entityId}`\n};\n\nmsg.payload = message;\nmsg.topic = 'aircon_notification';\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 220,
        "wires": [["message_formatter"]]
    },
    {
        "id": "message_formatter",
        "type": "function",
        "z": "aircon_flow_tab",
        "name": "è¨Šæ¯æ ¼å¼åŒ–å™¨",
        "func": "// ç‚ºä¸åŒçš„é€šçŸ¥æœå‹™æ ¼å¼åŒ–è¨Šæ¯\nconst data = msg.payload;\n\n// NotifyHelper æ ¼å¼\nconst notifyHelperMsg = {\n    topic: 'notify_helper',\n    payload: {\n        title: data.title,\n        message: data.fullMessage,\n        priority: 'normal',\n        sound: 'default'\n    }\n};\n\n// Synology Chat æ ¼å¼\nconst synologyChatMsg = {\n    topic: 'synology_chat',\n    payload: {\n        text: data.fullMessage,\n        username: 'Home Assistant',\n        icon_emoji: data.statusIcon\n    }\n};\n\n// Telegram æ ¼å¼\nconst telegramMsg = {\n    topic: 'telegram',\n    payload: {\n        chatId: process.env.TELEGRAM_CHAT_ID || 'YOUR_CHAT_ID',\n        type: 'message',\n        content: data.fullMessage,\n        options: {\n            parse_mode: 'HTML',\n            disable_notification: false\n        }\n    }\n};\n\n// è¿”å›ä¸‰å€‹è¼¸å‡º\nreturn [notifyHelperMsg, synologyChatMsg, telegramMsg];",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 220,
        "wires": [["notify_helper_sender"], ["synology_chat_sender"], ["telegram_sender"]]
    },
    {
        "id": "notify_helper_sender",
        "type": "api-call-service",
        "z": "aircon_flow_tab",
        "name": "NotifyHelper ç™¼é€",
        "server": "home_assistant_server",
        "version": 5,
        "debugenabled": false,
        "domain": "notify",
        "service": "notify",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"title\": \"{{payload.title}}\", \"message\": \"{{payload.message}}\"}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 850,
        "y": 160,
        "wires": [["notification_logger"]]
    },
    {
        "id": "synology_chat_sender",
        "type": "http request",
        "z": "aircon_flow_tab",
        "name": "Synology Chat ç™¼é€",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "YOUR_SYNOLOGY_CHAT_WEBHOOK_URL",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 850,
        "y": 220,
        "wires": [["notification_logger"]]
    },
    {
        "id": "telegram_sender",
        "type": "telegram sender",
        "z": "aircon_flow_tab",
        "name": "Telegram ç™¼é€",
        "bot": "telegram_bot",
        "hasenabled": false,
        "outputs": 1,
        "x": 850,
        "y": 280,
        "wires": [["notification_logger"]]
    },
    {
        "id": "notification_logger",
        "type": "debug",
        "z": "aircon_flow_tab",
        "name": "é€šçŸ¥æ—¥èªŒ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 220,
        "wires": []
    },
    {
        "id": "error_handler",
        "type": "catch",
        "z": "aircon_flow_tab",
        "name": "éŒ¯èª¤è™•ç†",
        "scope": null,
        "uncaught": false,
        "x": 1100,
        "y": 320,
        "wires": [["error_logger"]]
    },
    {
        "id": "error_logger",
        "type": "debug",
        "z": "aircon_flow_tab",
        "name": "éŒ¯èª¤æ—¥èªŒ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 320,
        "wires": []
    },
    {
        "id": "home_assistant_server",
        "type": "server",
        "name": "Home Assistant",
        "version": 4,
        "addon": true,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true,
        "heartbeat": false,
        "heartbeatInterval": 30
    },
    {
        "id": "telegram_bot",
        "type": "telegram bot",
        "botname": "AirCon Notification Bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksprotocol": "socks5",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    }
]
