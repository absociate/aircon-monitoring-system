<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“ä¸š3Då­—æ¯å±•å¼€å›¾ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .control-item label {
            font-weight: bold;
            color: #495057;
        }

        .letter-selector {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            gap: 5px;
            max-width: 600px;
        }

        .letter-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .letter-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .letter-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .slider {
            width: 150px;
            height: 5px;
            border-radius: 5px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }

        .generate-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .output-section {
            padding: 30px;
            text-align: center;
        }

        .svg-container {
            background: white;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .print-btn {
            background: linear-gradient(45deg, #6f42c1, #e83e8c);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4);
        }

        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .instructions h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        /* SVGæ ·å¼ */
        .cut-line {
            fill: none;
            stroke: #000;
            stroke-width: 2;
        }

        .fold-line {
            fill: none;
            stroke: #666;
            stroke-width: 1;
            stroke-dasharray: 3,3;
        }

        .letter-outline {
            fill: none;
            stroke: #000;
            stroke-width: 2;
        }

        .side-strip {
            fill: #f8f9fa;
            stroke: #000;
            stroke-width: 1;
        }

        .glue-tab {
            fill: #fff3cd;
            stroke: #856404;
            stroke-width: 1;
        }

        .label-text {
            font-family: Arial, sans-serif;
            font-size: 12px;
            text-anchor: middle;
            fill: #333;
        }

        .reference-outline {
            fill: none;
            stroke: #ccc;
            stroke-width: 1;
            stroke-dasharray: 2,2;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .svg-container, .svg-container * {
                visibility: visible;
            }
            .svg-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                border: none;
                padding: 0;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ ä¸“ä¸š3Då­—æ¯å±•å¼€å›¾ç”Ÿæˆå™¨</h1>
            <p>åŸºäºä¸“ä¸šæ¨¡æ¿è®¾è®¡ï¼Œç”Ÿæˆå¯ç›´æ¥åˆ¶ä½œçš„3Då­—æ¯å±•å¼€å›¾</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label>é€‰æ‹©å­—æ¯ï¼š</label>
                    <div class="letter-selector" id="letterSelector">
                        <!-- å­—æ¯æŒ‰é’®å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>

                <div class="control-item">
                    <label>å­—æ¯å¤§å°ï¼š</label>
                    <div class="slider-container">
                        <input type="range" id="sizeSlider" class="slider" min="150" max="400" value="250">
                        <span id="sizeValue">250px</span>
                    </div>
                </div>

                <div class="control-item">
                    <label>åšåº¦ï¼š</label>
                    <div class="slider-container">
                        <input type="range" id="thicknessSlider" class="slider" min="15" max="60" value="30">
                        <span id="thicknessValue">30px</span>
                    </div>
                </div>

                <div class="control-item">
                    <button class="generate-btn" onclick="generateProfessionalUnfold()">ç”Ÿæˆä¸“ä¸šå±•å¼€å›¾</button>
                </div>
            </div>
        </div>

        <div class="output-section">
            <div class="svg-container" id="svgContainer">
                <p style="color: #6c757d; font-size: 18px;">è¯·é€‰æ‹©å­—æ¯å¹¶ç‚¹å‡»"ç”Ÿæˆä¸“ä¸šå±•å¼€å›¾"</p>
            </div>
            
            <button class="print-btn" onclick="printUnfoldedLetter()" style="display: none;" id="printBtn">ğŸ–¨ï¸ æ‰“å°å±•å¼€å›¾</button>
            
            <div class="instructions">
                <h3>ğŸ“‹ ä¸“ä¸šåˆ¶ä½œè¯´æ˜ï¼š</h3>
                <ol>
                    <li><strong>æ‰“å°ï¼š</strong>ä½¿ç”¨A4æˆ–A3çº¸æ‰“å°ï¼ˆå»ºè®®160-200gå¡çº¸ï¼‰</li>
                    <li><strong>è£å‰ªï¼š</strong>æ²¿ç€<strong>å®çº¿</strong>è£å‰ªæ•´ä¸ªå±•å¼€å›¾è½®å»“</li>
                    <li><strong>æŠ˜å ï¼š</strong>æ²¿ç€<strong>è™šçº¿</strong>å‘ä¸ŠæŠ˜å 90åº¦</li>
                    <li><strong>ç»„è£…ï¼š</strong>å°†ä¾§é¢æ¡å¸¦å›´ç»•å­—æ¯è½®å»“ï¼Œé»„è‰²æ ‡ç­¾æ¶‚èƒ¶æ°´ç²˜è´´</li>
                    <li><strong>å®Œæˆï¼š</strong>ç¡®ä¿æ‰€æœ‰æ¥ç¼ç‰¢å›ºï¼Œç­‰å¾…èƒ¶æ°´å¹²ç‡¥</li>
                </ol>
                <p><strong>ğŸ’¡ ä¸“ä¸šæç¤ºï¼š</strong>å…ˆå¹²ç‡¥è¯•è£…ï¼Œç¡®è®¤æ— è¯¯åå†æ¶‚èƒ¶æ°´æ­£å¼ç²˜è´´ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        let selectedLetter = 'E';
        let letterSize = 250;
        let thickness = 30;

        // å­—æ¯è½®å»“æ•°æ®ï¼ˆç®€åŒ–çš„å¤šè¾¹å½¢ç‚¹ï¼‰
        const letterOutlines = {
            'A': [
                [125, 50], [175, 200], [150, 200], [140, 170], [110, 170], [100, 200], [75, 200], [125, 50]
            ],
            'B': [
                [75, 50], [75, 200], [140, 200], [155, 185], [155, 165], [140, 150], [150, 135], [150, 115], [140, 50], [75, 50]
            ],
            'C': [
                [175, 70], [155, 50], [95, 50], [75, 70], [75, 180], [95, 200], [155, 200], [175, 180]
            ],
            'D': [
                [75, 50], [75, 200], [140, 200], [175, 180], [175, 70], [140, 50], [75, 50]
            ],
            'E': [
                [75, 50], [75, 200], [175, 200], [175, 175], [125, 175], [125, 135], [155, 135], [155, 115], [125, 115], [125, 75], [175, 75], [175, 50], [75, 50]
            ],
            'F': [
                [75, 50], [75, 200], [100, 200], [100, 135], [155, 135], [155, 115], [100, 115], [100, 75], [175, 75], [175, 50], [75, 50]
            ],
            'G': [
                [175, 70], [155, 50], [95, 50], [75, 70], [75, 180], [95, 200], [155, 200], [175, 180], [175, 135], [135, 135], [135, 155], [155, 155]
            ],
            'H': [
                [75, 50], [75, 200], [100, 200], [100, 135], [150, 135], [150, 200], [175, 200], [175, 50], [150, 50], [150, 115], [100, 115], [100, 50], [75, 50]
            ],
            'I': [
                [100, 50], [100, 75], [115, 75], [115, 175], [100, 175], [100, 200], [150, 200], [150, 175], [135, 175], [135, 75], [150, 75], [150, 50], [100, 50]
            ],
            'J': [
                [150, 50], [150, 160], [135, 175], [115, 175], [100, 160], [100, 140], [85, 140], [85, 170], [105, 190], [145, 190], [165, 170], [165, 50], [150, 50]
            ],
            'K': [
                [75, 50], [75, 200], [100, 200], [100, 135], [130, 105], [175, 50], [145, 50], [115, 85], [115, 115], [145, 145], [175, 200], [145, 200], [100, 145], [100, 50], [75, 50]
            ],
            'L': [
                [75, 50], [75, 200], [175, 200], [175, 175], [100, 175], [100, 50], [75, 50]
            ],
            'M': [
                [75, 50], [75, 200], [100, 200], [100, 85], [125, 110], [150, 85], [150, 200], [175, 200], [175, 50], [150, 50], [125, 75], [100, 50], [75, 50]
            ],
            'N': [
                [75, 50], [75, 200], [100, 200], [100, 85], [150, 135], [150, 200], [175, 200], [175, 50], [150, 50], [150, 165], [100, 115], [100, 50], [75, 50]
            ],
            'O': [
                [125, 50], [95, 50], [75, 70], [75, 180], [95, 200], [155, 200], [175, 180], [175, 70], [155, 50], [125, 50]
            ],
            'P': [
                [75, 50], [75, 200], [100, 200], [100, 135], [140, 135], [155, 120], [155, 80], [140, 50], [75, 50]
            ],
            'Q': [
                [125, 50], [95, 50], [75, 70], [75, 180], [95, 200], [155, 200], [175, 180], [175, 70], [155, 50], [125, 50], [140, 165], [165, 190], [175, 180]
            ],
            'R': [
                [75, 50], [75, 200], [100, 200], [100, 135], [140, 135], [155, 120], [155, 80], [140, 50], [100, 50], [100, 115], [130, 115], [175, 200], [145, 200], [115, 135]
            ],
            'S': [
                [175, 70], [155, 50], [95, 50], [75, 70], [75, 90], [95, 110], [155, 110], [175, 130], [175, 180], [155, 200], [95, 200], [75, 180]
            ],
            'T': [
                [75, 50], [75, 75], [115, 75], [115, 200], [135, 200], [135, 75], [175, 75], [175, 50], [75, 50]
            ],
            'U': [
                [75, 50], [75, 180], [95, 200], [155, 200], [175, 180], [175, 50], [150, 50], [150, 175], [100, 175], [100, 50], [75, 50]
            ],
            'V': [
                [75, 50], [115, 200], [135, 200], [175, 50], [150, 50], [125, 175], [100, 50], [75, 50]
            ],
            'W': [
                [75, 50], [95, 200], [115, 200], [125, 125], [135, 200], [155, 200], [175, 50], [150, 50], [140, 175], [125, 100], [110, 175], [100, 50], [75, 50]
            ],
            'X': [
                [75, 50], [115, 90], [75, 200], [105, 200], [125, 125], [145, 200], [175, 200], [135, 160], [175, 50], [145, 50], [125, 125], [105, 50], [75, 50]
            ],
            'Y': [
                [75, 50], [115, 90], [115, 200], [135, 200], [135, 90], [175, 50], [145, 50], [125, 75], [105, 50], [75, 50]
            ],
            'Z': [
                [75, 50], [75, 75], [145, 175], [75, 175], [75, 200], [175, 200], [175, 175], [105, 75], [175, 75], [175, 50], [75, 50]
            ]
        };

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            createLetterSelector();
            updateSliderValues();
            generateProfessionalUnfold();
        }

        // åˆ›å»ºå­—æ¯é€‰æ‹©å™¨
        function createLetterSelector() {
            const selector = document.getElementById('letterSelector');
            const availableLetters = Object.keys(letterOutlines);

            for (let i = 65; i <= 90; i++) {
                const letter = String.fromCharCode(i);
                const btn = document.createElement('button');
                btn.className = 'letter-btn';
                btn.textContent = letter;

                if (availableLetters.includes(letter)) {
                    btn.onclick = () => selectLetter(letter, btn);
                    if (letter === 'E') btn.classList.add('active');
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.3';
                    btn.title = 'å³å°†æ¨å‡º';
                }

                selector.appendChild(btn);
            }
        }

        // é€‰æ‹©å­—æ¯
        function selectLetter(letter, btn) {
            document.querySelectorAll('.letter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedLetter = letter;
        }

        // æ›´æ–°æ»‘å—å€¼æ˜¾ç¤º
        function updateSliderValues() {
            const sizeSlider = document.getElementById('sizeSlider');
            const thicknessSlider = document.getElementById('thicknessSlider');
            const sizeValue = document.getElementById('sizeValue');
            const thicknessValue = document.getElementById('thicknessValue');

            sizeSlider.oninput = function() {
                letterSize = this.value;
                sizeValue.textContent = this.value + 'px';
            };

            thicknessSlider.oninput = function() {
                thickness = this.value;
                thicknessValue.textContent = this.value + 'px';
            };
        }

        // ç”Ÿæˆä¸“ä¸šå±•å¼€å›¾
        function generateProfessionalUnfold() {
            const container = document.getElementById('svgContainer');
            const printBtn = document.getElementById('printBtn');

            container.innerHTML = '';

            if (!letterOutlines[selectedLetter]) {
                container.innerHTML = '<p style="color: #dc3545;">è¯¥å­—æ¯æ¨¡æ¿æ­£åœ¨å¼€å‘ä¸­...</p>';
                return;
            }

            const svg = createProfessionalSVG();
            container.appendChild(svg);
            printBtn.style.display = 'inline-block';
        }

        // åˆ›å»ºä¸“ä¸šSVGå±•å¼€å›¾
        function createProfessionalSVG() {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '1000');
            svg.setAttribute('height', '700');
            svg.setAttribute('viewBox', '0 0 1000 700');

            // è·å–å­—æ¯è½®å»“ç‚¹
            const outline = letterOutlines[selectedLetter];
            const scale = letterSize / 250;
            const scaledThickness = thickness * scale;

            // ç¼©æ”¾è½®å»“ç‚¹
            const scaledOutline = outline.map(point => [
                point[0] * scale,
                point[1] * scale
            ]);

            // è®¡ç®—ä¸­å¿ƒä½ç½®
            const centerX = 300;
            const centerY = 200;

            // ç”Ÿæˆä¸»å±•å¼€å›¾
            generateMainUnfoldPattern(svg, scaledOutline, centerX, centerY, scaledThickness);

            // ç”Ÿæˆä¾§é¢æ¡å¸¦
            generateSideStrip(svg, scaledOutline, scaledThickness);

            // æ·»åŠ å‚è€ƒè½®å»“
            generateReferenceOutline(svg, scaledOutline, centerX + 400, centerY);

            // æ·»åŠ è¯´æ˜æ–‡å­—
            addInstructions(svg);

            return svg;
        }

        // ç”Ÿæˆä¸»å±•å¼€å›¾æ¡ˆ
        function generateMainUnfoldPattern(svg, outline, centerX, centerY, thickness) {
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.setAttribute('transform', `translate(${centerX}, ${centerY})`);

            // è®¡ç®—å¤–æ¡†ç‚¹ï¼ˆå‘å¤–æ‰©å±•thicknessè·ç¦»ï¼‰
            const outerOutline = expandOutline(outline, thickness);

            // ç»˜åˆ¶å¤–æ¡†ï¼ˆè£å‰ªçº¿ï¼‰
            const outerPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            outerPath.setAttribute('d', createPathFromPoints(outerOutline));
            outerPath.setAttribute('class', 'cut-line');
            group.appendChild(outerPath);

            // ç»˜åˆ¶å†…æ¡†ï¼ˆå­—æ¯è½®å»“ + æŠ˜å çº¿ï¼‰
            const innerPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            innerPath.setAttribute('d', createPathFromPoints(outline));
            innerPath.setAttribute('class', 'fold-line');
            group.appendChild(innerPath);

            // æ·»åŠ èƒ¶æ°´æ ‡ç­¾
            addGlueTabs(group, outerOutline, outline);

            // æ·»åŠ æ ‡ç­¾
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', '0');
            label.setAttribute('y', `${getOutlineBounds(outline).maxY + 40}`);
            label.setAttribute('class', 'label-text');
            label.textContent = `å­—æ¯ ${selectedLetter} - ä¸»ä½“å±•å¼€å›¾`;
            group.appendChild(label);

            svg.appendChild(group);
        }

        // æ‰©å±•è½®å»“ï¼ˆå‘å¤–ï¼‰
        function expandOutline(outline, distance) {
            const expanded = [];
            const len = outline.length;

            for (let i = 0; i < len; i++) {
                const prev = outline[(i - 1 + len) % len];
                const curr = outline[i];
                const next = outline[(i + 1) % len];

                // è®¡ç®—æ³•å‘é‡
                const normal = calculateOutwardNormal(prev, curr, next);

                // å‘å¤–æ‰©å±•
                expanded.push([
                    curr[0] + normal[0] * distance,
                    curr[1] + normal[1] * distance
                ]);
            }

            return expanded;
        }

        // è®¡ç®—å‘å¤–æ³•å‘é‡
        function calculateOutwardNormal(prev, curr, next) {
            // è®¡ç®—ä¸¤ä¸ªè¾¹çš„å‘é‡
            const v1 = [curr[0] - prev[0], curr[1] - prev[1]];
            const v2 = [next[0] - curr[0], next[1] - curr[1]];

            // è®¡ç®—å¹³å‡æ³•å‘é‡
            const n1 = [-v1[1], v1[0]]; // å‚ç›´å‘é‡
            const n2 = [-v2[1], v2[0]];

            let avgNormal = [(n1[0] + n2[0]) / 2, (n1[1] + n2[1]) / 2];

            // å½’ä¸€åŒ–
            const length = Math.sqrt(avgNormal[0] * avgNormal[0] + avgNormal[1] * avgNormal[1]);
            if (length > 0) {
                avgNormal = [avgNormal[0] / length, avgNormal[1] / length];
            }

            return avgNormal;
        }

        // ä»ç‚¹æ•°ç»„åˆ›å»ºSVGè·¯å¾„
        function createPathFromPoints(points) {
            if (points.length === 0) return '';

            let path = `M ${points[0][0]} ${points[0][1]}`;
            for (let i = 1; i < points.length; i++) {
                path += ` L ${points[i][0]} ${points[i][1]}`;
            }
            path += ' Z';
            return path;
        }

        // æ·»åŠ èƒ¶æ°´æ ‡ç­¾
        function addGlueTabs(group, outerOutline, innerOutline) {
            const tabSize = 15;

            // åœ¨å¤–æ¡†å’Œå†…æ¡†ä¹‹é—´æ·»åŠ èƒ¶æ°´æ ‡ç­¾
            for (let i = 0; i < outerOutline.length; i += 2) {
                const outer = outerOutline[i];
                const inner = innerOutline[i];

                // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼ˆä¸­ç‚¹ï¼‰
                const tabX = (outer[0] + inner[0]) / 2;
                const tabY = (outer[1] + inner[1]) / 2;

                const tab = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                tab.setAttribute('cx', tabX);
                tab.setAttribute('cy', tabY);
                tab.setAttribute('r', tabSize / 2);
                tab.setAttribute('class', 'glue-tab');
                group.appendChild(tab);

                // æ·»åŠ "èƒ¶"å­—
                const tabText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tabText.setAttribute('x', tabX);
                tabText.setAttribute('y', tabY + 3);
                tabText.setAttribute('class', 'label-text');
                tabText.setAttribute('style', 'font-size: 10px;');
                tabText.textContent = 'èƒ¶';
                group.appendChild(tabText);
            }
        }

        // ç”Ÿæˆä¾§é¢æ¡å¸¦
        function generateSideStrip(svg, outline, thickness) {
            const perimeter = calculatePerimeter(outline);
            const stripWidth = perimeter;
            const stripHeight = thickness;

            const stripGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            stripGroup.setAttribute('transform', 'translate(100, 500)');

            // ä¸»æ¡å¸¦
            const mainStrip = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            mainStrip.setAttribute('x', '0');
            mainStrip.setAttribute('y', '0');
            mainStrip.setAttribute('width', stripWidth);
            mainStrip.setAttribute('height', stripHeight);
            mainStrip.setAttribute('class', 'cut-line');
            mainStrip.setAttribute('fill', '#f8f9fa');
            stripGroup.appendChild(mainStrip);

            // åˆ†æ®µçº¿ï¼ˆæŠ˜å çº¿ï¼‰
            const segments = Math.ceil(stripWidth / 50); // æ¯50pxä¸€æ®µ
            for (let i = 1; i < segments; i++) {
                const x = (stripWidth / segments) * i;
                const segmentLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                segmentLine.setAttribute('x1', x);
                segmentLine.setAttribute('y1', '0');
                segmentLine.setAttribute('x2', x);
                segmentLine.setAttribute('y2', stripHeight);
                segmentLine.setAttribute('class', 'fold-line');
                stripGroup.appendChild(segmentLine);
            }

            // èƒ¶æ°´æ ‡ç­¾ï¼ˆä¸Šä¸‹ä¸¤æ’ï¼‰
            const tabCount = Math.floor(segments / 2);
            for (let i = 0; i < tabCount; i++) {
                const x = (stripWidth / tabCount) * (i + 0.5);

                // ä¸Šæ–¹æ ‡ç­¾
                const topTab = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                topTab.setAttribute('x', x - 10);
                topTab.setAttribute('y', -15);
                topTab.setAttribute('width', '20');
                topTab.setAttribute('height', '15');
                topTab.setAttribute('class', 'glue-tab');
                stripGroup.appendChild(topTab);

                // ä¸‹æ–¹æ ‡ç­¾
                const bottomTab = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bottomTab.setAttribute('x', x - 10);
                bottomTab.setAttribute('y', stripHeight);
                bottomTab.setAttribute('width', '20');
                bottomTab.setAttribute('height', '15');
                bottomTab.setAttribute('class', 'glue-tab');
                stripGroup.appendChild(bottomTab);
            }

            // æ ‡ç­¾
            const stripLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            stripLabel.setAttribute('x', stripWidth / 2);
            stripLabel.setAttribute('y', stripHeight + 40);
            stripLabel.setAttribute('class', 'label-text');
            stripLabel.textContent = `ä¾§é¢æ¡å¸¦ - é•¿åº¦: ${Math.round(stripWidth)}px`;
            stripGroup.appendChild(stripLabel);

            svg.appendChild(stripGroup);
        }

        // è®¡ç®—è½®å»“å‘¨é•¿
        function calculatePerimeter(outline) {
            let perimeter = 0;
            for (let i = 0; i < outline.length; i++) {
                const curr = outline[i];
                const next = outline[(i + 1) % outline.length];
                const dx = next[0] - curr[0];
                const dy = next[1] - curr[1];
                perimeter += Math.sqrt(dx * dx + dy * dy);
            }
            return perimeter;
        }

        // ç”Ÿæˆå‚è€ƒè½®å»“
        function generateReferenceOutline(svg, outline, centerX, centerY) {
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.setAttribute('transform', `translate(${centerX}, ${centerY})`);

            const refPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            refPath.setAttribute('d', createPathFromPoints(outline));
            refPath.setAttribute('class', 'reference-outline');
            refPath.setAttribute('fill', '#f0f0f0');
            group.appendChild(refPath);

            const refLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            refLabel.setAttribute('x', '0');
            refLabel.setAttribute('y', `${getOutlineBounds(outline).maxY + 30}`);
            refLabel.setAttribute('class', 'label-text');
            refLabel.textContent = `å‚è€ƒè½®å»“ - ${selectedLetter}`;
            group.appendChild(refLabel);

            svg.appendChild(group);
        }

        // è·å–è½®å»“è¾¹ç•Œ
        function getOutlineBounds(outline) {
            const xs = outline.map(p => p[0]);
            const ys = outline.map(p => p[1]);
            return {
                minX: Math.min(...xs),
                maxX: Math.max(...xs),
                minY: Math.min(...ys),
                maxY: Math.max(...ys)
            };
        }

        // æ·»åŠ è¯´æ˜æ–‡å­—
        function addInstructions(svg) {
            const instructions = [
                'åˆ¶ä½œè¯´æ˜ï¼š',
                '1. æ²¿å®çº¿è£å‰ª',
                '2. æ²¿è™šçº¿æŠ˜å ',
                '3. é»„è‰²åŒºåŸŸæ¶‚èƒ¶æ°´',
                '4. æŒ‰é¡ºåºç²˜è´´ç»„è£…'
            ];

            instructions.forEach((text, index) => {
                const instruction = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                instruction.setAttribute('x', '50');
                instruction.setAttribute('y', `${50 + index * 20}`);
                instruction.setAttribute('class', 'label-text');
                instruction.setAttribute('style', 'font-size: 14px; fill: #666;');
                instruction.textContent = text;
                svg.appendChild(instruction);
            });
        }

        // æ‰“å°åŠŸèƒ½
        function printUnfoldedLetter() {
            window.print();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = initializePage;
    </script>
</body>
</html>
