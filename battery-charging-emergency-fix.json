[
    {
        "id": "7aa6bd9d6c51a86b",
        "type": "tab",
        "label": "é›»æ± å……é›»ç·Šæ€¥ä¿®æ­£ç‰ˆ",
        "disabled": false,
        "info": "ç·Šæ€¥ä¿®æ­£ç‰ˆæœ¬ - è§£æ±ºéåº¦å……é›»å•é¡Œ\n\nğŸš¨ ç·Šæ€¥åŠŸèƒ½ï¼š\n1. ç«‹å³é—œé–‰æ‰€æœ‰å……é›»è¨­å‚™\n2. æª¢æŸ¥ç•¶å‰å……é›»ç‹€æ…‹\n3. ä¿®æ­£NotifyHelperé€šçŸ¥\n\nâš ï¸ ä½¿ç”¨èªªæ˜ï¼š\n1. å…ˆé»æ“Šã€Œç·Šæ€¥é—œé–‰æ‰€æœ‰å……é›»ã€\n2. æª¢æŸ¥è¨­å‚™å’Œé›»æ± ç‹€æ…‹\n3. æ¸¬è©¦ä¿®æ­£å¾Œçš„é€šçŸ¥åŠŸèƒ½",
        "env": []
    },
    {
        "id": "emergency_stop_all",
        "type": "inject",
        "z": "7aa6bd9d6c51a86b",
        "name": "ğŸš¨ ç·Šæ€¥é—œé–‰æ‰€æœ‰å……é›»",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "emergency_stop",
        "payloadType": "str",
        "x": 130,
        "y": 60,
        "wires": [["emergency_handler"]]
    },
    {
        "id": "emergency_handler",
        "type": "function",
        "z": "7aa6bd9d6c51a86b",
        "name": "ç·Šæ€¥è™•ç†å™¨",
        "func": "// é›»æ± é…ç½®\nconst batteries = [\n    {\n        entityId: 'switch.tp_link_power_strip_eb2f_cha_shang_4',\n        name: 'ç‰§ç”°BL1041Bå……é›»é›»æ± '\n    },\n    {\n        entityId: 'switch.tp_link_power_strip_eb2f_cha_shang_5',\n        name: 'ENELOOP 3è™Ÿå……é›»é›»æ± '\n    },\n    {\n        entityId: 'switch.tp_link_power_strip_eb2f_cha_shang_6',\n        name: 'ENELOOP 4è™Ÿå……é›»é›»æ± '\n    }\n];\n\n// æº–å‚™é—œé–‰å‘½ä»¤\nconst outputs = [];\n\n// é€šçŸ¥è¨Šæ¯\nconst notifyMsg = {\n    payload_notifyhelper: {\n        message: `ğŸš¨ ç·Šæ€¥é—œé–‰æ‰€æœ‰å……é›»è¨­å‚™\\n\\nå·²é—œé–‰ï¼š\\nâ€¢ ç‰§ç”°BL1041Bå……é›»é›»æ± \\nâ€¢ ENELOOP 3è™Ÿå……é›»é›»æ± \\nâ€¢ ENELOOP 4è™Ÿå……é›»é›»æ± \\n\\nâ° åŸ·è¡Œæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}\\n\\nè«‹æª¢æŸ¥è¨­å‚™ç‹€æ…‹å’Œé›»æ± æº«åº¦ã€‚`,\n        title: 'ğŸš¨ ç·Šæ€¥é—œé–‰å……é›»',\n        targets: ['person.ming']\n    }\n};\n\noutputs.push(notifyMsg);\n\n// ç‚ºæ¯å€‹é›»æ± å‰µå»ºé—œé–‰å‘½ä»¤\nbatteries.forEach(battery => {\n    outputs.push({\n        payload: {\n            domain: 'switch',\n            service: 'turn_off',\n            target: {\n                entity_id: battery.entityId\n            }\n        },\n        batteryName: battery.name\n    });\n});\n\nnode.status({fill:\"red\", shape:\"dot\", text:\"ç·Šæ€¥é—œé–‰åŸ·è¡Œ\"});\n\nreturn outputs;",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 60,
        "wires": [["notify_helper"], ["device_control"], ["device_control"], ["device_control"]]
    },
    {
        "id": "check_status",
        "type": "inject",
        "z": "7aa6bd9d6c51a86b",
        "name": "ğŸ” æª¢æŸ¥å……é›»ç‹€æ…‹",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "check_status",
        "payloadType": "str",
        "x": 130,
        "y": 120,
        "wires": [["status_checker"]]
    },
    {
        "id": "status_checker",
        "type": "function",
        "z": "7aa6bd9d6c51a86b",
        "name": "ç‹€æ…‹æª¢æŸ¥å™¨",
        "func": "// æº–å‚™ç‹€æ…‹æª¢æŸ¥é€šçŸ¥\nconst notifyMsg = {\n    payload_notifyhelper: {\n        message: `ğŸ” å……é›»ç‹€æ…‹æª¢æŸ¥\\n\\nè«‹æ‰‹å‹•æª¢æŸ¥ä»¥ä¸‹è¨­å‚™ï¼š\\n\\nğŸ”Œ æ’åº§4 (ç‰§ç”°BL1041B)\\nğŸ”Œ æ’åº§5 (ENELOOP 3è™Ÿ)\\nğŸ”Œ æ’åº§6 (ENELOOP 4è™Ÿ)\\n\\næª¢æŸ¥é …ç›®ï¼š\\nâ€¢ å……é›»å™¨æ˜¯å¦é‚„åœ¨é‹ä½œ\\nâ€¢ é›»æ± æº«åº¦æ˜¯å¦æ­£å¸¸\\nâ€¢ å……é›»æŒ‡ç¤ºç‡ˆç‹€æ…‹\\n\\nâ° æª¢æŸ¥æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`,\n        title: 'ğŸ” å……é›»ç‹€æ…‹æª¢æŸ¥',\n        targets: ['person.ming']\n    }\n};\n\nnode.status({fill:\"blue\", shape:\"dot\", text:\"ç‹€æ…‹æª¢æŸ¥\"});\n\nreturn notifyMsg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 120,
        "wires": [["notify_helper"]]
    },
    {
        "id": "test_notify",
        "type": "inject",
        "z": "7aa6bd9d6c51a86b",
        "name": "ğŸ§ª æ¸¬è©¦é€šçŸ¥",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "test_notify",
        "payloadType": "str",
        "x": 130,
        "y": 180,
        "wires": [["test_notifier"]]
    },
    {
        "id": "test_notifier",
        "type": "function",
        "z": "7aa6bd9d6c51a86b",
        "name": "æ¸¬è©¦é€šçŸ¥å™¨",
        "func": "// æº–å‚™æ¸¬è©¦é€šçŸ¥\nconst notifyMsg = {\n    payload_notifyhelper: {\n        message: `ğŸ§ª NotifyHelperæ¸¬è©¦é€šçŸ¥\\n\\né€™æ˜¯ä¸€å€‹æ¸¬è©¦è¨Šæ¯ï¼Œç”¨æ–¼é©—è­‰NotifyHelperæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚\\n\\nâœ… å¦‚æœæ‚¨æ”¶åˆ°é€™å€‹é€šçŸ¥ï¼Œè¡¨ç¤ºNotifyHelperé…ç½®æ­£ç¢ºã€‚\\n\\nâ° æ¸¬è©¦æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`,\n        title: 'ğŸ§ª NotifyHelperæ¸¬è©¦',\n        targets: ['person.ming']\n    }\n};\n\nnode.status({fill:\"green\", shape:\"dot\", text:\"æ¸¬è©¦é€šçŸ¥\"});\n\nreturn notifyMsg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 180,
        "wires": [["notify_helper"]]
    },
    {
        "id": "notify_helper",
        "type": "api-call-service",
        "z": "7aa6bd9d6c51a86b",
        "name": "NotifyHelper (ming)",
        "server": "125d83f7.1a33dc",
        "version": 7,
        "debugenabled": false,
        "action": "notify.notify_person",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"message\": payload_notifyhelper.message, \"title\": payload_notifyhelper.title, \"targets\": payload_notifyhelper.targets}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "notify",
        "service": "notify_person",
        "x": 580,
        "y": 140,
        "wires": [["debug_notify"]]
    },
    {
        "id": "device_control",
        "type": "api-call-service",
        "z": "7aa6bd9d6c51a86b",
        "name": "è¨­å‚™æ§åˆ¶",
        "server": "125d83f7.1a33dc",
        "version": 7,
        "debugenabled": false,
        "action": "{{payload.domain}}.{{payload.service}}",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": ["{{payload.target.entity_id}}"],
        "labelId": [],
        "data": "{}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "",
        "service": "",
        "x": 580,
        "y": 60,
        "wires": [["debug_control"]]
    },
    {
        "id": "debug_notify",
        "type": "debug",
        "z": "7aa6bd9d6c51a86b",
        "name": "NotifyHelper Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 140,
        "wires": []
    },
    {
        "id": "debug_control",
        "type": "debug",
        "z": "7aa6bd9d6c51a86b",
        "name": "æ§åˆ¶Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 60,
        "wires": []
    },
    {
        "id": "125d83f7.1a33dc",
        "type": "server",
        "name": "Home Assistant",
        "addon": true
    }
]
