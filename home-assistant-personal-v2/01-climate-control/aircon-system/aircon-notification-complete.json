[
    {
        "id": "f1e2d3c4b5a6",
        "type": "tab",
        "label": "ç©ºèª¿è¨­å‚™é€šçŸ¥ç³»çµ±",
        "disabled": false,
        "info": "ç›£æ§5å€‹ç©ºèª¿è¨­å‚™çš„é–‹å•Ÿèˆ‡é—œé–‰ç‹€æ…‹ï¼Œä¸¦ç™¼é€é€šçŸ¥åˆ° NotifyHelperã€Synology Chat å’Œ Telegram\n\nè¨­å‚™æ¸…å–®ï¼š\n1. åŠéš±é™¤æ¿•æ©Ÿ (humidifier.rdi_640hhchu_shi_ji)\n2. å…¨ç†±äº¤æ›å™¨ (fan.kpi_253hwquan_re_jiao_huan_qi_air_speed)\n3. å®¢å»³å†·æ°£ (climate.ke_ting_leng_qi)\n4. ä¸»è‡¥å†·æ°£ (climate.zhu_wo_leng_qi)\n5. æ¬¡è‡¥å†·æ°£ (climate.ci_wo_leng_qi)",
        "env": []
    },
    {
        "id": "a1b2c3d4e5f6",
        "type": "server-state-changed",
        "z": "f1e2d3c4b5a6",
        "name": "åŠéš±é™¤æ¿•æ©Ÿç‹€æ…‹ç›£æ§",
        "server": "125d83f7.1a33dc",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["humidifier.rdi_640hhchu_shi_ji"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 160,
        "y": 100,
        "wires": [["state_processor"]]
    },
    {
        "id": "b2c3d4e5f6a1",
        "type": "server-state-changed",
        "z": "f1e2d3c4b5a6",
        "name": "å…¨ç†±äº¤æ›å™¨ç›£æ§",
        "server": "125d83f7.1a33dc",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["fan.kpi_253hwquan_re_jiao_huan_qi_air_speed"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 160,
        "y": 160,
        "wires": [["state_processor"]]
    },
    {
        "id": "c3d4e5f6a1b2",
        "type": "server-state-changed",
        "z": "f1e2d3c4b5a6",
        "name": "å®¢å»³å†·æ°£ç›£æ§",
        "server": "125d83f7.1a33dc",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["climate.ke_ting_leng_qi"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 160,
        "y": 220,
        "wires": [["state_processor"]]
    },
    {
        "id": "d4e5f6a1b2c3",
        "type": "server-state-changed",
        "z": "f1e2d3c4b5a6",
        "name": "ä¸»è‡¥å†·æ°£ç›£æ§",
        "server": "125d83f7.1a33dc",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["climate.zhu_wo_leng_qi"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 160,
        "y": 280,
        "wires": [["state_processor"]]
    },
    {
        "id": "e5f6a1b2c3d4",
        "type": "server-state-changed",
        "z": "f1e2d3c4b5a6",
        "name": "æ¬¡è‡¥å†·æ°£ç›£æ§",
        "server": "125d83f7.1a33dc",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": ["climate.ci_wo_leng_qi"],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 160,
        "y": 340,
        "wires": [["state_processor"]]
    },
    {
        "id": "state_processor",
        "type": "function",
        "z": "f1e2d3c4b5a6",
        "name": "ç‹€æ…‹è™•ç†å™¨",
        "func": "// è¨­å‚™åç¨±å°æ‡‰è¡¨\nconst deviceNames = {\n    'humidifier.rdi_640hhchu_shi_ji': 'åŠéš±é™¤æ¿•æ©Ÿ',\n    'fan.kpi_253hwquan_re_jiao_huan_qi_air_speed': 'å…¨ç†±äº¤æ›å™¨',\n    'climate.ke_ting_leng_qi': 'å®¢å»³å†·æ°£',\n    'climate.zhu_wo_leng_qi': 'ä¸»è‡¥å†·æ°£',\n    'climate.ci_wo_leng_qi': 'æ¬¡è‡¥å†·æ°£'\n};\n\n// ä½ç½®å°æ‡‰è¡¨\nconst deviceLocations = {\n    'humidifier.rdi_640hhchu_shi_ji': 'å®¢å»³',\n    'fan.kpi_253hwquan_re_jiao_huan_qi_air_speed': 'å…¨å±‹',\n    'climate.ke_ting_leng_qi': 'å®¢å»³',\n    'climate.zhu_wo_leng_qi': 'ä¸»è‡¥å®¤',\n    'climate.ci_wo_leng_qi': 'æ¬¡è‡¥å®¤'\n};\n\n// ç‹€æ…‹å°æ‡‰è¡¨\nconst stateNames = {\n    'on': 'é–‹å•Ÿ',\n    'off': 'é—œé–‰',\n    'heat': 'åŠ ç†±æ¨¡å¼',\n    'cool': 'å†·å»æ¨¡å¼',\n    'auto': 'è‡ªå‹•æ¨¡å¼',\n    'dry': 'é™¤æ¿•æ¨¡å¼',\n    'fan_only': 'é€é¢¨æ¨¡å¼',\n    'low': 'ä½é€Ÿ',\n    'medium': 'ä¸­é€Ÿ',\n    'high': 'é«˜é€Ÿ',\n    'unavailable': 'ç„¡æ³•é€£æ¥',\n    'unknown': 'æœªçŸ¥ç‹€æ…‹'\n};\n\n// ç‹€æ…‹åœ–ç¤ºå°æ‡‰\nconst statusIcons = {\n    'on': 'ğŸŸ¢',\n    'off': 'ğŸ”´',\n    'heat': 'ğŸ”¥',\n    'cool': 'â„ï¸',\n    'auto': 'ğŸ”„',\n    'dry': 'ğŸ’¨',\n    'fan_only': 'ğŸŒªï¸',\n    'low': 'ğŸŸ¢',\n    'medium': 'ğŸŸ¡',\n    'high': 'ğŸ”´',\n    'unavailable': 'âš ï¸',\n    'unknown': 'â“'\n};\n\n// ç²å–å¯¦é«”è³‡è¨Š\nconst entityId = msg.data.entity_id;\nconst newState = msg.data.new_state.state;\nconst oldState = msg.data.old_state ? msg.data.old_state.state : null;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„ç‹€æ…‹è®ŠåŒ–\nif (!newState || newState === oldState) {\n    return null;\n}\n\n// æª¢æŸ¥æ˜¯å¦éœ€è¦ç™¼é€é€šçŸ¥ï¼ˆé¿å…é‡è¤‡é€šçŸ¥ï¼‰\nconst contextKey = `lastState_${entityId}`;\nconst lastNotifiedState = context.get(contextKey);\n\nif (lastNotifiedState === newState) {\n    return null;\n}\n\n// æ›´æ–°ä¸Šæ¬¡é€šçŸ¥çš„ç‹€æ…‹\ncontext.set(contextKey, newState);\n\n// ç²å–è¨­å‚™è³‡è¨Š\nconst deviceName = deviceNames[entityId] || entityId;\nconst location = deviceLocations[entityId] || 'æœªçŸ¥ä½ç½®';\nconst stateName = stateNames[newState] || newState;\nconst oldStateName = stateNames[oldState] || oldState;\nconst statusIcon = statusIcons[newState] || 'ğŸŸ¡';\n\n// ç”Ÿæˆæ™‚é–“æˆ³è¨˜\nconst timestamp = new Date().toLocaleString('zh-TW', {\n    timeZone: 'Asia/Taipei',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit'\n});\n\n// æ§‹å»ºè¨Šæ¯å…§å®¹\nconst message = {\n    deviceName: deviceName,\n    location: location,\n    entityId: entityId,\n    newState: stateName,\n    oldState: oldStateName,\n    timestamp: timestamp,\n    statusIcon: statusIcon,\n    title: `${deviceName}ç‹€æ…‹è®Šæ›´`,\n    shortMessage: `${deviceName} ${stateName}`,\n    fullMessage: `${timestamp}\\n${deviceName}å·²${stateName}\\nä½ç½®ï¼š${location}`\n};\n\nmsg.payload = message;\nmsg.topic = 'aircon_notification';\n\n// è¨˜éŒ„åˆ°é™¤éŒ¯æ—¥èªŒ\nnode.log(`è¨­å‚™ç‹€æ…‹è®Šæ›´: ${deviceName} (${entityId}) å¾ ${oldStateName} è®Šæ›´ç‚º ${stateName}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 220,
        "wires": [["message_formatter"]]
    },
    {
        "id": "message_formatter",
        "type": "function",
        "z": "f1e2d3c4b5a6",
        "name": "å»ºç«‹é€šçŸ¥è¨Šæ¯",
        "func": "const data = msg.payload;\nconst message = data.fullMessage;\nconst title = data.title;\n\n// NotifyHelper æ ¼å¼ - åƒè€ƒæ‚¨çš„ç¯„ä¾‹\nmsg.payload_notifyhelper = {\n    message: message,\n    title: title,\n    data: {\n        targets: [\"person.ming\"]\n    }\n};\n\n// Synology Chat æ ¼å¼ - åƒè€ƒæ‚¨çš„ç¯„ä¾‹\nmsg.payload_synology_chat = {\n    message: message\n};\n\n// Telegram æ ¼å¼ - åƒè€ƒæ‚¨çš„ç¯„ä¾‹\nmsg.payload_telegram = {\n    message: message\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 220,
        "wires": [["delay_notify", "delay_synology", "delay_telegram"]]
    },
    {
        "id": "delay_notify",
        "type": "delay",
        "z": "f1e2d3c4b5a6",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 860,
        "y": 160,
        "wires": [["notify_helper_sender"]]
    },
    {
        "id": "delay_synology",
        "type": "delay",
        "z": "f1e2d3c4b5a6",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 860,
        "y": 220,
        "wires": [["synology_chat_sender"]]
    },
    {
        "id": "delay_telegram",
        "type": "delay",
        "z": "f1e2d3c4b5a6",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 860,
        "y": 280,
        "wires": [["telegram_sender"]]
    },
    {
        "id": "notify_helper_sender",
        "type": "api-call-service",
        "z": "f1e2d3c4b5a6",
        "name": "NotifyHelperé€šçŸ¥",
        "server": "125d83f7.1a33dc",
        "version": 7,
        "debugenabled": false,
        "action": "notify.notify",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"message\": payload_notifyhelper.message, \"title\": payload_notifyhelper.title, \"data\": {\"targets\": [\"person.ming\"]}}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "notify",
        "service": "notify",
        "x": 1080,
        "y": 160,
        "wires": [["debug_notify"]]
    },
    {
        "id": "synology_chat_sender",
        "type": "api-call-service",
        "z": "f1e2d3c4b5a6",
        "name": "Synology Chaté€šçŸ¥",
        "server": "125d83f7.1a33dc",
        "version": 7,
        "debugenabled": false,
        "action": "notify.synology_chat_bot_3",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"message\": payload_synology_chat.message}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "notify",
        "service": "synology_chat_bot_3",
        "x": 1080,
        "y": 220,
        "wires": [["debug_synology"]]
    },
    {
        "id": "telegram_sender",
        "type": "api-call-service",
        "z": "f1e2d3c4b5a6",
        "name": "ç™¼é€Telegramé€šçŸ¥",
        "server": "125d83f7.1a33dc",
        "version": 7,
        "debugenabled": false,
        "action": "notify.telegram",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"message\": payload_telegram.message}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "notify",
        "service": "telegram",
        "x": 1080,
        "y": 280,
        "wires": [["debug_telegram"]]
    },
    {
        "id": "debug_notify",
        "type": "debug",
        "z": "f1e2d3c4b5a6",
        "name": "NotifyHelperé™¤éŒ¯",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1320,
        "y": 160,
        "wires": []
    },
    {
        "id": "debug_synology",
        "type": "debug",
        "z": "f1e2d3c4b5a6",
        "name": "Synologyé™¤éŒ¯",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1320,
        "y": 220,
        "wires": []
    },
    {
        "id": "debug_telegram",
        "type": "debug",
        "z": "f1e2d3c4b5a6",
        "name": "Telegramé™¤éŒ¯",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1320,
        "y": 280,
        "wires": []
    },
    {
        "id": "manual_test_inject",
        "type": "inject",
        "z": "f1e2d3c4b5a6",
        "name": "æ‰‹å‹•æ¸¬è©¦",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "data"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "test",
        "payloadType": "str",
        "data": "{\"entity_id\":\"climate.ke_ting_leng_qi\",\"new_state\":{\"state\":\"cool\"},\"old_state\":{\"state\":\"off\"}}",
        "dataType": "json",
        "x": 160,
        "y": 400,
        "wires": [["state_processor"]]
    },
    {
        "id": "error_handler",
        "type": "catch",
        "z": "f1e2d3c4b5a6",
        "name": "éŒ¯èª¤è™•ç†",
        "scope": null,
        "uncaught": false,
        "x": 1080,
        "y": 360,
        "wires": [["error_logger"]]
    },
    {
        "id": "error_logger",
        "type": "debug",
        "z": "f1e2d3c4b5a6",
        "name": "éŒ¯èª¤æ—¥èªŒ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 360,
        "wires": []
    },
    {
        "id": "125d83f7.1a33dc",
        "type": "server",
        "name": "Home Assistant",
        "addon": true
    }
]
